/**
 * Mico Solutions EULA
 * http://www.micosolutions.com/
 * Read the license at http://www.micosolutions.com/license.txt
 *
 * Do not edit or add to this file, please refer to http://www.micosolutions.com for more information.
 *
 * @author		Pham Tri Cong <phtcong@micosolutions.com>
 * @copyright   Copyright (c) 2011 Mico Solutions (http://www.micosolutions.com)
 * @license     http://www.micosolutions.com/license.txt
 *
 */
if(!String.prototype.trim){String.prototype.trim=function(){if(!this){return""}var a=this+"";return a.replace(/^\s+|\s+$/g,"")}}micoCrop=0;var micoPriceUtil=0;var optionsPrice=0;var spConfig=0;var micoCmpQtyItemFilter="#qty";var micoCmpZeroPriceText="Please choose options";var micoProductAddToCartForm;var micoCmpGroupedPriceItem=0;var micoCmpTotalPrice=0;var micoCmpSCP=0;var micoCmpMagentoNewVersion=1;var micoCmpPriceItem="";var micoCmpPriceExcludeTaxItem=".product-info-price .price-box .price-excluding-tax .price";var micoCmpPriceIncludeTaxItem=".product-info-price .price-box .price-including-tax .price";var micoCartButton=".product-view .add-to-cart button";var reloadConfigureMode="";var micoCmpQtyItem=0;var micoCmpQtyKeyup=1;var _MICO_INIT_PRICE=0;MicoCustomMathPricing=function(a){this.initialize(a)};MicoCustomMathPricing.prototype={initialize:function(c){this._radix=1;this._config=c;this._includeTax=0;this._excludeTax=0;this._errorElements=0;this._currentUploadedData=0;this._cropCurrentWidth=0;this._cropCurrentHeight=0;this._customizedData=0;this._enteredData=0;this._errorData=0;this._processing=0;this._numRound=100;this._unitMath="";this._unitText="";this._unitElement=0;this._numMin=1/this._numRound;this._customizedDataPrices=new Object();this._effectPrices=new Object();this._notEffectPrices=new Object();this._effectPriceTotal=0;this._pricePercent=1;this._optionElements=new Object();this._cmpGroupedElements=new Object();this._onKeyupText=1;this._onChangeText=1;this._currentTax=0;this._priceUtil=micoPriceUtil?micoPriceUtil:0;if(c&&c.labels&&c.optionMap){if(this._config.groupedMode){}else{this._currentTax=this.getProductTax();this._config.basePrice=parseFloat(this._config.price)}this._config.spPerimeter=0;var b=parseFloat(this._config.radix);if(b>0){var a=1/b;while(a>this._numRound){this._numRound=this._numRound*10}}this._radix=this._config.labels.radix;if(this._config.groupedMode){micoCmpPriceItem=0;this.loadGrouped()}else{this.load()}if(this._config.crop&&this._config.crop.convertMath){this._config.crop.convertToDefaultMath=this.reconvertMath(this._config.crop.convertMath)}if(this._config.labels.max){this._maxSize=this._config.labels.max}else{this._maxSize=0}if(this._config.configureMode){reloadConfigureMode=setInterval(function(){clearInterval(reloadConfigureMode);if(this._unitElement){micoCustomMathPricing.changeUnitOptionMath(this._unitElement)}else{micoCustomMathPricing.changeBasePrice(0)}}.bind(this),1000)}if(c.labels.showTotal){micoCmpTotalPrice=1}}this._numMin=1/this._numRound},getProductTax:function(){pid=this._config.productId;itemInclId="#price-including-tax-product-price-"+pid;itemExclId="#price-excluding-tax-product-price-"+pid;priceIncl=0;priceExcl=0;jQuery(itemInclId).each(function(a,b){priceIncl=jQuery(b).attr("data-price-amount")*1});jQuery(itemExclId).each(function(a,b){priceExcl=jQuery(b).attr("data-price-amount")*1});ret=0;if((priceExcl>0)&&(priceIncl>priceExcl)){ret=(priceIncl-priceExcl)*100/priceExcl}return ret},findOptionId:function(b){if(!b){return}var c,d,a=jQuery(b).attr("name");if(a.indexOf("[")!==-1){c=/\[([^\]]+)?\]/}else{c=/_([^\]]+)?_/}d=c.exec(a)&&c.exec(a)[1];if(d){return d}},getDefault:function(a){if(!this._config||!this._config.labels||!this._config.labels.values){return 0}var b="{"+a+"_default}";if(!this._config.labels.values[b]){return 0}return this._config.labels.values[b]*1},getDefaultPerimeter:function(a){if(!this._config||!this._config.labels||!this._config.labels.values){return 0}var b="{"+a+"_perimeter_default}";if(!this._config.labels.values[b]){return 0}return this._config.labels.values[b]*1},getElementRadioCheckedFilter:function(a){if(a.typeExt=="thumb_gallery"){return"#options-"+a.id+'-list .emiprooptactive input[type="radio"]'}return"#options-"+a.id+'-list input:checked[type="radio"]'},getElementRadioText:function(d,c,b){var e=jQuery(b).val();if(!e||!this._config.options[c]){return""}var a=this._config.options[c].titles;return a[e]},getElementText:function(i,a){if(i.type=="radio"){var b=this.getElementRadioCheckedFilter(i);var d="";var h="label";if(i.typeExt=="thumb_gallery"){h="span"}jQuery(b).each(function(j,k){d=this.getElementRadioText(i,a,k);if(!d){d=jQuery(k).next(h).text();if(!d&&(h=="label")){d=jQuery(k).parent().find("label").text()}}if(!d||(d=="None")||(d=="none")||(d=="NONE")){d=""}else{d=d.replace(/<.*/g,"").trim()}}.bind(this));return d}var c=jQuery("#"+this.getField(i));var f="";if(!c){return f}if(!c.type){c.type=i.type}if(c.type=="select-one"||c.type=="select-multiple"||c.type=="select"){var g=c.val();if(g){if(a&&this._config.options&&this._config.options[a]&&this._config.options[a]["titles"]&&this._config.options[a]["titles"][g]){return this._config.options[a]["titles"][g]}var e=c.selectedIndex;f=e>=0?c.options[e].innerHTML:""}}else{f=c.val()}return f},calcMathString:function(math){if(!math){return 0}math=math.replace(new RegExp("{[a-zA-Z0-9_]+}","gi"),0);var ret=0;try{ret=eval(math)}catch(err){}return ret},calcMathFromData:function(a,b){return this.calcMathFromDataWidthMark(a,b,"")},calcMathFromDataWidthMark:function(b,e,g){b=String(b);var d=b;var c=b;var f=new Object();var a=0;jQuery.each(e,function(i,h){d=d.replace(new RegExp("{"+i+"}","gi"),h);if(g){if(d!=c){a=1;c=d;f[i]=g}}}.bind(this));this._calcMarkData=a?f:0;return this.calcMathString(d)},getMappingVal:function(c,b){if(!c){return 0}var a=c.trim().toLowerCase();if(this._config&&this._config.labels&&this._config.labels.values){if(this._config.labels.values["{"+b+"}_{"+a+"}"]!=undefined){return this._config.labels.values["{"+b+"}_{"+a+"}"]}if(this._config.labels.values["{"+b+"}"]!=undefined){return this._config.labels.values["{"+b+"}"]}if(this._config.labels.values["{"+a+"}"]!=undefined){return this._config.labels.values["{"+a+"}"]}}return c},getMathNumber:function(d,c,b){if(!d){return 0}var a=d.trim().toLowerCase();if(this._config&&this._config.labels&&this._config.labels.values){if(this._config.labels.values["{"+b+"}_{"+a+"}"]!=undefined){return this.getProNumber(this._config.labels.values["{"+b+"}_{"+a+"}"],c)}if(this._config.labels.values["{"+b+"}"]!=undefined){return this.getProNumber(this._config.labels.values["{"+b+"}"],c)}if(this._config.labels.values["{"+a+"}"]!=undefined){return this.getProNumber(this._config.labels.values["{"+a+"}"],c)}}var e=optionsPrice?optionsPrice.priceFormat:{groupSymbol:",",decimalSymbol:"."};d=d.replace(e.groupSymbol,"");d=d.replace(e.decimalSymbol,".");d=parseFloat(d);if(this._config.math.unitOptions&&this._config.math.unitOptions[b]){return this.getProNumber(d,c)}return isNaN(d)?0:this._radix*d},getProNumber:function(val,math){if(!val){return 0}if(math){val=math.replace(/{val}/ig,val);val=eval(val)}else{val=val*this._config.labels.radix}return isNaN(val)?0:val*1},reconvertMath:function(a){if(!a){return""}var b=this.getProNumber(1,a);return"{val}/"+b},changeUnitOptionMath:function(b){var a;if(b.type=="radio"){b.id.sub(/[0-9]+$/,function(c){a=c[0]})}else{a=b.getValue()}if(!a){this._unitMath="";this._unitText=""}else{this._unitMath=this._config.unitOption["optionUnitMath"][a];if(b.type=="radio"){this._unitText=this._config.unitOption["titles"][b.getValue()]}else{this._unitText=this._config.unitOption["titles"][a]}}this.changeBasePrice(0)},getOptionPrice:function(c,f,e){var d=0;var a=0;if(e.type=="radio"){var b=this.getElementRadioCheckedFilter(e);var g="";jQuery(b).each(function(h,j){d=jQuery(j).val()}.bind(this))}else{d=jQuery(c).val()}if(!d){return a}else{if(this._config.options&&this._config.options[f]&&this._config.options[f]["price"]&&this._config.options[f]["price"][d]){return this._config.options[f]["price"][d]}}return a},addEffectPriceItem:function(a,b){if(this._effectPrices[a]){this._effectPriceTotal+=b;return 0}else{if(this._notEffectPrices[a]){return 0}else{if(!this._config.math.basePrice){return 0}if(this._config.math.basePrice.indexOf("{"+a+"}")!=-1){this._effectPrices[a]=1;this._effectPriceTotal+=b}else{this._notEffectPrices[a]=1}}}},applyPriceRule:function(a){return a*this._pricePercent},getQty:function(){if(!micoCmpQtyItem){return 1}return micoCmpQtyItem.val()*1},getCustomizedData:function(){this._enteredData=new Object();var b=this._config.labels.initData?this._config.labels.initData:new Object();var d;var e;var f;var c="";this._customizedDataPrices=new Object();this._effectPriceTotal=0;jQuery.each(this._config.options,function(i,h){e=i;if(h.type=="multiselect"){b=this.setMultiselectVals(b,e,h)}else{if(h.type=="checkbox"){b=this.setCheckboxVals(b,e,h)}else{d=jQuery("#"+this.getField(h));f=this.getElementText(h,e);if(!this._config.math.unitOptions||this._config.math.unitOptions[e]){c=this._unitMath}else{c=this._config.math.unitDefault}b[e+"_real"]=f;b[e]=f?this.getMathNumber(f,c,e):this.getDefault(e);b[e+"_perimeter"]=f?this.getMathNumber(f,c,e):this.getDefaultPerimeter(e);b[e+"_price"]=f?this.applyPriceRule(this.getOptionPrice(d,e,h)):0;this._customizedDataPrices[e+"_price"]=b[e+"_price"];this.addEffectPriceItem(e+"_price",b[e+"_price"]);if(f){this._enteredData[e]=b[e]}}}}.bind(this));var g=this.getQty();if(g<=0){g=1}b.qty=g;b.weight=this._config.weight;if(this._config.labels.cmpGroup){b.customergroup=this._config.labels.cmpGroupVal;b.customergroup_real=this._config.labels.cmpGroupReal}if(this._config&&this._config.productcmp){jQuery.each(this._config.productcmp,function(h,i){b[h]=i}.bind(this))}b.price=this.loadTierPrice(g,this._config.basePrice);if(b.cmp_tier_qty){b.price=this.loadTierPrice(b.cmp_tier_qty,this._config.basePrice)}if(this._config.pricesheet){var a=this.getCustomizedCsvPrice(b)*1;b.csvprice=a;this.log("csvprice="+a)}if(this._config&&this._config.nonoptions){jQuery.each(this._config.nonoptions,function(i,h){var j=0;if(h){j=this.calcMathFromData(h,b)}if(this._config.labels.loopoptions&&this._config.labels.loopoptions[i]){if(!j){j=0}j=this.getMappingVal(j+"",this._config.labels.loopoptions[i])}b[i]=j;if((i=="cmp_tier_qty")&&(j>0)){b.price=this.loadTierPrice(j,this._config.basePrice)}}.bind(this))}this._customizedData=b;return b},setMultiselectVals:function(f,a,j){var b="#select_"+j.id+" option";f[a+"_real"]=0;f[a]=0;f[a+"_perimeter"]=0;f[a+"_price"]=0;this._customizedDataPrices[a+"_price"]=0;var h=0;var k="";if(!this._config.math.unitOptions||this._config.math.unitOptions[a]){unitMath=this._unitMath}else{unitMath=this._config.math.unitDefault}var e;var i;var c;var g;var d=0;jQuery(b).each(function(l,m){e=m.value;c=j.titles[e];g=this.getMappingVal(c,a);d=this._config.options&&this._config.options[a]&&this._config.options[a]["price"]&&this._config.options[a]["price"][e];i=a+"_"+g;f[i+"_real"]=c;f[i]=m.selected?1:0;f[i+"_perimeter"]=g;f[i+"_price"]=d?this.applyPriceRule(d):0;this._customizedDataPrices[i+"_price"]=f[i+"_price"];if(c){this._enteredData[i]=f[i]}}.bind(this));return f},setCheckboxVals:function(f,a,j){var b="#options-"+j.id+'-list input[type="checkbox"]';f[a+"_real"]=0;f[a]=0;f[a+"_perimeter"]=0;f[a+"_price"]=0;this._customizedDataPrices[a+"_price"]=0;var h=0;var k="";if(!this._config.math.unitOptions||this._config.math.unitOptions[a]){unitMath=this._unitMath}else{unitMath=this._config.math.unitDefault}var e;var i;var c;var g;var d=0;jQuery(b).each(function(l,m){e=m.value;c=j.titles[e];g=this.getMappingVal(c,a);d=this._config.options&&this._config.options[a]&&this._config.options[a]["price"]&&this._config.options[a]["price"][e];i=a+"_"+g;f[i+"_real"]=c;f[i]=m.checked?1:0;f[i+"_perimeter"]=g;f[i+"_price"]=d?this.applyPriceRule(d):0;this._customizedDataPrices[i+"_price"]=f[i+"_price"];if(c){this._enteredData[i]=f[i]}}.bind(this));return f},getCustomizedPrice:function(a){if(!this._config.math.basePrice){return this._config.basePrice}return this.calcMathFromData(this._config.math.basePrice,a)},calcUpcharge:function(){if(!this._config||!this._config.math||!this._config.math.upchargePrice){return 0}var c=0;var a;var d;var b=0;var e={};jQuery.each(this._config.math.upchargePrice,function(g,f){e.key=g;e.value=f;a=e.key;d=this.calcMathFromData(a,this._customizedData);if(d){b=this.calcMathFromData(e.value,this._customizedData);c+=b}}.bind(this));return c},calcUpchargeItem:function(c,b){var a=0;var d=0;if(b){b.each(function(e){d=parseFloat(e.qty);if(c>=d){a=this.calcMathFromData(e.price,this._customizedData)}}.bind(this))}return a},changeUploadedOfCrop:function(b){if(b){this._currentUploadedData=b}if(!this._currentUploadedData){return 0}if(!this._config||!this._config.crop||!this._config.crop.width||!this._config.crop.height||!this._config.crop.convertMath||!this._config.crop.dpi){return 0}this._cropCurrentWidth=0;this._cropCurrentHeight=0;var a=this._currentUploadedData.imageWidth/this._config.crop.dpi;var e=this._currentUploadedData.imageHeight/this._config.crop.dpi;var d=this.getProNumber(a,this._config.crop.convertToDefaultMath);var c=this.getProNumber(e,this._config.crop.convertToDefaultMath);if(!this._maxSize){this._config.labels.max=new Object();this._config.labels.max[this._config.crop.width]=d;this._config.labels.max[this._config.crop.height]=c}else{if(this._maxSize[this._config.crop.width]){if(this._maxSize[this._config.crop.width]>d){this._config.labels.max[this._config.crop.width]=d}else{this._config.labels.max[this._config.crop.width]=this._maxSize[this._config.crop.width]}}if(this._maxSize[this._config.crop.height]){if(this._maxSize[this._config.crop.height]>c){this._config.labels.max[this._config.crop.height]=c}else{this._config.labels.max[this._config.crop.height]=this._maxSize[this._config.crop.width]}}}this.changeBasePrice(0);this.checkSizeNotSelect()},checkSizeNotSelect:function(){if(!this._customizedData||!this._customizedData[this._config.crop.width]||!this._customizedData[this._config.crop.height]||!this._customizedData[this._config.crop.width+"_real"]||!this._customizedData[this._config.crop.height+"_real"]){return this.throwSizeNotSelectEvent()}var b=this._customizedData[this._config.crop.width];var a=this._customizedData[this._config.crop.height];if((b<=0)||(a<=0)){return this.throwSizeNotSelectEvent()}},throwSizeNotSelectEvent:function(){this.fireEvent("mcrop:CropEventSizeNotSelect",{optionId:0})},throwChangeSizeEvent:function(){return 0;if(!this._config.crop||!this._config.crop.width||!this._config.crop.height||!this._config.crop.convertMath||!this._config.crop.dpi||!this._customizedData||!this._customizedData[this._config.crop.width]||!this._customizedData[this._config.crop.height]||!this._customizedData[this._config.crop.width+"_real"]||!this._customizedData[this._config.crop.height+"_real"]){return 0}var b=this._customizedData[this._config.crop.width];var a=this._customizedData[this._config.crop.height];if((b<=0)||(a<=0)){return 0}b=this.getProNumber(b,this._config.crop.convertMath);a=this.getProNumber(a,this._config.crop.convertMath);if((this._cropCurrentWidth==b)&&(this._cropCurrentHeight==a)){return 0}this._cropCurrentWidth=b;this._cropCurrentHeight=a;this.fireEvent("mcrop:selectNormalPrintsize",{x:b,y:a,dpi:this._config.crop.dpi})},cmpValidate:function(){if(!this._enteredData||!this._config.labels||(!this._config.labels.min&&!this._config.labels.max)){return 0}this._errorData=new Object();var b=0;var c;var e;var a;var d={};jQuery.each(this._enteredData,function(g,f){d.key=g;d.value=f;c=d.key;e=d.value;a=this.cmpValidateItem(c,e);if(a){b=1;this._errorData[c]=a}}.bind(this));if(!b){this._errorData=0}return b?0:1},cmpValidateItem:function(c,d){var b=this._config.labels.min&&this._config.labels.min[c]?this._config.labels.min[c]:0;if(b>d){return this.cmpErrorText(c,b,0)}var a=this._config.labels.max&&this._config.labels.max[c]?this._config.labels.max[c]:0;if(a&&(a<d)){return this.cmpErrorText(c,0,a)}return 0},cmpErrorText:function(f,c,b){var e=this._config.labels.radix*1;if(e<=0){e=1}if(this._unitMath){var d=this.getProNumber(100,this._unitMath);if(d){e=d/100}}c=this.cmpFloor(c/e);b=this.cmpFloor(b/e);var a=c?this._config.labels.alertMin:this._config.labels.alertMax;a=a.replace(/{min}/g,c);a=a.replace(/{max}/g,b);a=a.replace(/{title}/g,this._config.options[f].label);a=a.replace(/{unit}/g,this._unitText);return a},cmpFloor:function(a){return Math.floor(a*100)/100},customValidate:function(){if(!this._config||!this._config.math||!this._config.math.customValidations){return 1}var c=1;this._errorData=0;var a;var d;var b="";var e={};jQuery.each(this._config.math.customValidations,function(g,f){e.key=g;e.value=f;if(c){a=e.key;b=e.value;d=this.calcMathFromDataWidthMark(a,this._customizedData,b);if(d){this._errorData=this._calcMarkData;c=0}}}.bind(this));return this._errorData?c:1},showCmpErrors:function(){if(!this._errorData){return 0}var a,d,b;var c={};jQuery.each(this._errorData,function(f,e){c.key=f;c.value=e;a=c.key;d=c.value;if(this._config.options&&this._config.options[a]){b=this._config.options[a].id;if(this._config.groupedMode){this.showCmpError(this._cmpGroupedElements[b],d,b)}else{this.showCmpError(this.cmpElement(this._config.options[a]),d,b)}}}.bind(this));var c={};jQuery.each(this._config.options,function(f,e){c.key=f;c.value=e;a=c.key;if(!this._errorData[a]){b=this._config.options[a].id;this.clearCmpError(this.cmpElement(this._config.options[a]),b)}}.bind(this));this.disableButton()},getAdvice:function(c,b){var a=0;jQuery("#"+c).each(function(d,e){a=e}.bind(this));return a},createAdvice:function(d,c,a,e){var b='<div id="'+d+'" class="mage-error" generated="true">'+e+"</div>";c.after(b);jQuery(c).addClass("mage-error")},showAdvice:function(b,a,c){},hideAdvice:function(b,a,c){jQuery(b).removeClass("mage-error");jQuery(a).html("")},showCmpError:function(b,e,d){if(!b){return 0}if(!this._errorElements){this._errorElements=new Object()}this._errorElements[d]=b;var c="mico-cmp-failed-"+d;var a=this.getAdvice(c,b);if(!a){a=this.createAdvice(c,b,false,e)}else{jQuery(a).html(e)}this.showAdvice(b,a,c)},clearCmpErrors:function(){if(!this._config.options){return 0}var a,d,b;var c={};jQuery.each(this._config.options,function(f,e){c.key=f;c.value=e;a=c.key;b=this._config.options[a].id;this.clearCmpError(this.cmpElement(this._config.options[a]),b)}.bind(this));this._errorElements=0},clearCmpError:function(b,d){if(!b){return 0}if(this._errorElements&&this._errorElements[d]){b=this._errorElements[d]}var c="mico-cmp-failed-"+d;var a=this.getAdvice(c,b);if(a){this.hideAdvice(b,a,c)}},cmpElement:function(c){if(c.type=="radio"){var b=this.getElementRadioCheckedFilter(c);var a=0;jQuery(b).each(function(d,e){if(!a){a=e}}.bind(this));return a}if(c.type=="select"){return jQuery("#"+this.getFieldSelect(c.id))}return jQuery("#"+this.getFieldText(c.id))},getNumberFormat:function(a){if(!a){return 0}if(a>=this._numMin){return(Math.round(a*this._numRound)/this._numRound).toString()}return(Math.round(a*this._numRound*10)/(this._numRound*10)).toString()},getField:function(a){if(this._optionElements[a.id]){return this._optionElements[a.id]}if(a.type=="select"){return this.getFieldSelect(a.id)}if(a.type=="checkbox"){return this.getFieldSelect(a.id)}if(a.type=="radio"){return this.getFieldRadio(a.id)}return this.getFieldText(a.id)},getFieldCheckbox:function(a){return"options_"+a},getFieldText:function(a){return"options_"+a+"_text"},getFieldSelect:function(a){return"select_"+a},getFieldRadio:function(a){return"options-"+a+"-list"},getCmpCode:function(a){return this._config&&this._config.optionMap&&this._config.optionMap[a]?this._config.optionMap[a]:0},isCmpField:function(a){return this._config.optionMap&&this._config.optionMap[a]?1:0},load:function(){jQuery(".product-custom-option").each(function(a,b){var c=this.findOptionId(b);if(this.isCmpField(c)){if(b.type=="checkbox"||b.type=="radio"){jQuery(b).click(function(){this.changeBasePrice(c)}.bind(this))}else{if(b.type=="text"){if(this._onKeyupText){jQuery(b).keyup(function(){this.changeBasePrice(c)}.bind(this))}if(this._onChangeText){jQuery(b).change(function(){this.changeBasePrice(c)}.bind(this))}}else{jQuery(b).change(function(){this.changeBasePrice(c)}.bind(this))}}}else{if(this._config.unitOption&&(c==this._config.unitOption.id)){if(b.type=="checkbox"||b.type=="radio"){jQuery(b).click(function(){this.changeUnitOptionMath.bind(b)}.bind(this));if(b.checked){this._unitElement=b}}else{jQuery(b).change(function(){this.changeUnitOptionMath.bind(b)}.bind(this));this._unitElement=b}}else{if(b.type=="checkbox"||b.type=="radio"){jQuery(b).click(function(){this.changeBasePrice(c)}.bind(this))}else{if(b.type=="text"){if(this._onKeyupText){jQuery(b).keyup(function(){this.changeBasePrice(c)}.bind(this))}if(this._onChangeText){jQuery(b).change(function(){this.changeBasePrice(c)}.bind(this))}}else{jQuery(b).change(function(){this.changeBasePrice(c)}.bind(this))}}}}}.bind(this));jQuery(micoCmpPriceIncludeTaxItem).each(function(a,b){this._includeTax=1}.bind(this));jQuery(micoCmpPriceExcludeTaxItem).each(function(a,b){this._excludeTax=1}.bind(this));if(!micoCmpPriceItem){jQuery(".product-info-price .price-box .price").each(function(a,b){if(this._includeTax){micoCmpPriceItem=micoCmpPriceIncludeTaxItem}else{micoCmpPriceItem=".product-info-price .price-box .price"}});if(!micoCmpPriceItem){jQuery(".product-info-price .price-box .price").each(function(a,b){if(this._includeTax){micoCmpPriceItem=micoCmpPriceIncludeTaxItem}else{micoCmpPriceItem=micoCmpPriceExcludeTaxItem}})}}this.reloadQtyItem()},reloadQtyItem:function(){jQuery(micoCmpQtyItemFilter).each(function(a,b){micoCmpQtyItem=jQuery(b)}.bind(this));if(micoCmpQtyItem){jQuery(micoCmpQtyItem).change(function(){this.changeBasePrice(0)}.bind(this));if(micoCmpQtyKeyup){jQuery(micoCmpQtyItem).keyup(function(){this.changeBasePrice(0)}.bind(this))}}},changeRelations:function(f,e,d){if(!this._config.labels.relations){return 0}var a=$H(this._config.labels.relations);var c,b,g;a.each(function(h){c=h.key;b=h.value;if(b&&(b.indexOf(e)>0)){g=this.calcMathFromData(b,d);if(this.setRelation(c,g)){}}}.bind(this));return d},setRelation:function(c,d){if(!this._config||!this._config.options||!this._config.options[c]){return 0}var b=this._config.options[c];if(b.type!="text"){return 0}var a=$(this.getField(b));a.setValue(d);return 1},changeBasePrice:function(d){if(!_MICO_INIT_PRICE){return 0}if(this._processing||!this._config){return 1}this._processing=1;var i=this.getCustomizedData();if(d&&this._config.labels&&this._config.labels.relations){var b=this.getCmpCode(d);var f=this.changeRelations(d,b,i);if(f){i=this.getCustomizedData()}}if(!this.cmpValidate()){this.showCmpErrors();this._processing=0;return 0}else{}if(!this.customValidate()){this.showCmpErrors();this._processing=0;return 0}else{}this.clearCmpErrors();var j=this.getCustomizedPrice(i);if(this._customizedData){this._customizedData.newprice=j}if(this._config&&this._config.labels&&this._config.labels.cmpQty){if(micoCmpQtyItem){jQuery(micoCmpQtyItem).val(j)}this._processing=0;return 0}this._processing=0;this.fireEvent("percentage:BasePriceChange",{price:optionsPrice.productPrice,customizedData:i});var e=this.calcUpcharge();var a=0;var g=0;if((g>a)&&micoCmpMagentoNewVersion){g=g-a}else{}if(g<0){g=0}g=this.applyPriceRule(g);var m;var h;m=parseFloat(j)+g;h=m+e;this._cmpPrice=m;this._finalPrice=h;this._normalPrice=g;var l=h;if(micoCmpTotalPrice){var c=this._customizedData&&this._customizedData.qty?this._customizedData.qty:1;l=l*c}this._totalPrice=l;this._lastPrice=l||!micoCmpZeroPriceText?this.formatPrice(l):micoCmpZeroPriceText;if(this._totalPrice==0){return 0}_mico_set_update_after_price(this.finalUpdatePrice.bind(this));var k={};k.price=l;k.zeroText=micoCmpZeroPriceText;this.fireEvent("cmpreload",k);this._processing=0;this.fireEvent("loadtotal:finalPriceChange",{price:h,clearAuto:1,qtyEvent:0});this.fireEvent("cmp:chagnedprice",{price:h,clearAuto:1,qtyEvent:0});this.throwChangeSizeEvent()},finalUpdatePrice:function(){this.updatePrice();this.updateAllPrice()},formatPrice:function(a){if(this._priceUtil){return this._priceUtil.formatPrice(a)}var b=a;return b},loadGrouped:function(){var productId=this._config.groupedProductId;if(!optionsPrice.priceFormat){var v="optionsPrice"+this._config.groupedProductId;var js="(typeof("+v+") !== 'undefined') ? "+v+" : 0";cmpOptionsPrice=eval(js);if(spConfig&&spConfig.optionsPrice&&spConfig.optionsPrice.priceFormat){optionsPrice.priceFormat=spConfig.optionsPrice.priceFormat}else{if(cmpOptionsPrice&&cmpOptionsPrice.priceFormat){optionsPrice.priceFormat=cmpOptionsPrice.priceFormat}else{optionsPrice.priceFormat={pattern:"$%s",precision:2,requiredPrecision:2,decimalSymbol:".",groupSymbol:",",groupLength:3,integerRequired:1}}}}if(!optionsPrice.productPrice){optionsPrice.productPrice=this._config.groupedPrice}this._productPrice=this._config.groupedPrice;jQuery(micoCmpQtyItemFilter).each(function(i,el){var optionId=0;var tname=el.name.sub(/[0-9]+\]$/,function(match){optionId=match[0].replace("]","")});this._cmpGroupedElements[optionId]=el;if(!micoCmpGroupedPriceItem){this.setGroupedPriceItem(el)}if(this.isCmpField(optionId)){this._optionElements[optionId]=el;if(el.type=="checkbox"||el.type=="radio"){el.observe("click",this.changeBasePrice.bind(this,optionId))}else{if(el.type=="text"){if(this._onKeyupText){el.observe("keyup",this.changeBasePrice.bind(this,optionId))}if(this._onChangeText){el.observe("change",this.changeBasePrice.bind(this,optionId))}}else{el.observe("change",this.changeBasePrice.bind(this,optionId))}}}else{if(this._config.unitOption&&(optionId==this._config.unitOption.id)){if(el.type=="checkbox"||el.type=="radio"){el.observe("click",this.changeUnitOptionMath.bind(this,el));if(el.checked){this._unitElement=el}}else{el.observe("change",this.changeUnitOptionMath.bind(this,el));this._unitElement=el}}else{if(el.type=="checkbox"||el.type=="radio"){el.observe("click",this.changeBasePrice.bind(this,0))}else{if(el.type=="text"){if(this._onKeyupText){el.observe("keyup",this.changeBasePrice.bind(this,optionId))}if(this._onChangeText){el.observe("change",this.changeBasePrice.bind(this,optionId))}}else{el.observe("change",this.changeBasePrice.bind(this,0))}}}}}.bind(this))},setGroupedPriceItem:function(e){var d="#product-price-"+this._config.groupedProductId+" .price";jQuery(d).each(function(g,h){micoCmpGroupedPriceItem=h});if(micoCmpGroupedPriceItem){var f=this.formatPrice(this._config.groupedPrice);var a="product-final-price-"+this._config.groupedProductId;var b='<span id="'+a+'" class="price">'+f+"</span>";var c=micoCmpGroupedPriceItem.up();c.insert({bottom:b});micoCmpGroupedPriceItem.setStyle({display:"none"});micoCmpGroupedPriceItem=$(a)}d="#price-excluding-tax-"+this._config.groupedProductId;jQuery(d).each(function(g,h){micoCmpGroupedPriceItem=h});if(micoCmpGroupedPriceItem){return 0}d="#price-including-tax-"+this._config.groupedProductId;jQuery(d).each(function(g,h){micoCmpGroupedPriceItem=h});if(micoCmpGroupedPriceItem){return 0}},updatePrice:function(){var a=this._lastPrice;if(micoCmpPriceItem){jQuery(micoCmpPriceItem).each(function(b,c){jQuery(c).html(a)}.bind(this))}},updateAllPrice:function(){exclPrice=this._totalPrice;var a=0;if(this._currentTax&&this._includeTax){a=exclPrice*(100+this._currentTax)/100;this.updatePriceByFiler(micoCmpPriceIncludeTaxItem,a)}},numberToPrice:function(a){return this.formatPrice(a)},updatePriceByFiler:function(a,b){if(a){var c=this.numberToPrice(b);jQuery(a).each(function(d,e){jQuery(e).html(c)})}},getNormalPrice:function(b){var a=0;if(this._config.normal){jQuery(".product-custom-option").each(function(c,d){var e=0;d.name.sub(/[0-9]+/,function(f){e=f[0]});if(this._config.normal[e]){a+=this.getValueFromConfig(d,this._config.normal[e])}}.bind(this))}return a},getValueFromConfig:function(c,b){var a=0;if(c.type=="checkbox"||c.type=="radio"){if(c.checked){if(b[c.getValue()]){a+=parseFloat(b[c.getValue()])}}}else{if(c.type=="select-one"||c.type=="select-multiple"){if(c.options){$A(c.options).each(function(d){if(d.selected){if(b[d.value]){a+=parseFloat(b[d.value])}}})}}else{if(c.getValue().strip()!=""){a+=parseFloat(b)}}}return a},loadTierPrice:function(d,b){var a=b;var e;var c;if(!d||!this._config||!this._config.tierPrices){return a}jQuery(this._config.tierPrices).each(function(f,g){e=parseFloat(g.price_qty);if(d>=e){c=parseFloat(g.price);if(c<=a){a=c}}});return a},loadRemoveCustomPrice:function(){var a=0;if(!this._config||!this._config.labels||!this._config.labels.customPriceRemove){return a}this._config.labels.customPriceRemove.each(function(b){if(this._customizedData&&this._customizedData[b+"_price"]){a+=this._customizedData[b+"_price"]}}.bind(this));return a},getCustomizedCsvPrice:function(c){if(!c||!this._config||!this._config.pricesheet||!this._config.csv||!this._config.csv.row||!this._config.csv.col){return 0}var d=this.calcMathFromData(this._config.csv.row,c)*1;var b=this.calcMathFromData(this._config.csv.col,c)*1;this.log("getCustomizedCsvPrice->row="+d);this.log("getCustomizedCsvPrice->col="+b);if((b<=0)&&(d<=0)){return 0}this.log("col="+b+",row="+d);d=Math.ceil(d);b=Math.ceil(b);if((d<this._config.minmax.minRow)&&(b<this._config.minmax.minCol)){return 0}if((d>this._config.minmax.maxRow)&&(b>this._config.minmax.maxCol)){return 0}while(!this._config.pricesheet[d]){if(this._config.csvPriceMin){d=d-1;if((d<1)||(d<this._config.minmax.minRow)){return 0}}else{d=d+1;if(d>this._config.minmax.maxRow){return 0}}}this.log("to row="+d);while(!this._config.pricesheet[d][b]){if(this._config.pricesheet[d][b]===0){return 0}if(this._config.csvPriceMin){b=b-1;if((b<0)||(b<this._config.minmax.minCol)){return 0}}else{b=b+1;if(b>this._config.minmax.maxCol){return 0}}}this.log("to col="+b);var a=this._config.pricesheet[d][b]*1;this.log("ret="+a);if(a<=0){return 0}return a},bindEvent:function(a,b){if(!b){return 0}jQuery("body").on(a,function(d,c){b(c)})},fireEvent:function(a,b){jQuery("body").trigger(a,b)},disableButton:function(){if(micoCrop){return 0}jQuery(micoCartButton).each(function(a,b){b.disabled=true;b.addClassName("mico-cmp-btn-none")}.bind(this))},enableButton:function(){if(micoCrop){return 0}jQuery(micoCartButton).each(function(a,b){b.disabled=false;b.removeClassName("mico-cmp-btn-none")}.bind(this))},log:function(a){console.log(a)}};function abs(a){return Math.abs(a)}function ceil(a){return Math.ceil(a)}function floor(a){return Math.floor(a)}function round(a){return Math.round(a)}function strlen(a){if(!a){if((a+"")=="0"){return 1}return 0}return(a+"").length}function strtolower(a){if(!a){if((a+"")=="0"){return"0"}return""}return a.toLowerCase()}function strpos(a,b){if(a===""){return -1}return a.indexOf(b)}function strrpos(a,b){if(a===""){return -1}return a.lastIndexOf(b)}function str_replace(b,a,c){if(c==="0"){return"0"}if(c===""){return""}if(c===0){return 0}if(!c){return""}return c.replace(b,a)}function check_number(a){if(a===""){return 0}return isNaN(a)?0:1}var _mico_cmp_timer_price=0;var _mico_cmp_timer_seconds=50;function _mico_set_update_after_price(a){if(_mico_cmp_timer_price){return 1}_mico_cmp_timer_price=setInterval(function(){a();_mico_clear_update_after_price()},_mico_cmp_timer_seconds)}function _mico_clear_update_after_price(){if(!_mico_cmp_timer_price){return 1}clearInterval(_mico_cmp_timer_price);_mico_cmp_timer_price=0}function _mico_update_cmp_price_util(){if(micoCustomMathPricing){if(micoCustomMathPricing._config&&micoCustomMathPricing._config.labels){micoCustomMathPricing.finalUpdatePrice()}}};